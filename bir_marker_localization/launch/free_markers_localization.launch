<?xml version="1.0"?>
<launch>

    <arg name="enable/publish_image" default="true"/>
    <arg name="enable/publish_markers" default="true"/>
    <arg name="enable/tf" default="true"/>
    <arg name="markers/prefix" default="id_"/>
    <arg name="markers/dictionary" default="11"/>
    <arg name="markers/lengths" default="[55]"/>
    <arg name="camera/tf_name" default="camera"/>
    <!-- <arg name="camera/matrix" default="[500.0, 0.0, 0.0, 0.0, 500.0, 0.0, 0.0, 0.0, 1.0]" /> -->
    <arg name="camera/matrix" default="[806.63826, 0.0, 288.1348, 0.0, 809.52025, 232.06243 0.0, 0.0, 1.0]" />
    <!-- <arg name="camera/distortion" default="[0.0, 0.0, 0.0, 0.0, 0.0]" /> -->
    <arg name="camera/distortion" default="[0.090272, -0.147990, 0.001263, 0.001272, 0.000000]" />
    <arg name="markers_param_file" default="$(find marker_localization)/config/markers_config.yaml" />

    <node pkg="usb_cam" name="usb_cam" type="usb_cam_node">
        <param name="video_device" value="/dev/video0" />
        <param name="image_width" value="960" />
        <param name="image_height" value="720" />
        <param name="pixel_format" value="yuyv" />
        <param name="color_format" value="yuv422p" />
        <param name="camera_frame_id" value="camera" />
        <param name="io_method" value="mmap"/>
        <!-- <param name="camera_info_url" value="sring"> -->
    </node>
        

    <node pkg="marker_localization" type="free_markers_localization" name="free_markers_localization" output="screen">
        <param name="enable/publish_image" value="$(arg enable/publish_image)"/>
        <param name="enable/publish_markers" value="$(arg enable/publish_markers)"/>
        <param name="enable/tf" value="$(arg enable/tf)"/>
        <param name="camera/tf_name" value="$(arg camera/tf_name)"/>
        <param name="markers/prefix" value="$(arg markers/prefix)"/>
        <param name="markers/dictionary" value="$(arg markers/dictionary)"/>
        
        <rosparam param="markers/lengths" subst_value="true">$(arg markers/lengths)</rosparam>
        <rosparam param="camera/matrix" subst_value="true">$(arg camera/matrix)</rosparam>
        <rosparam param="camera/distortion" subst_value="true">$(arg camera/distortion)</rosparam>

        <rosparam command="load" file="$(arg markers_param_file)"></rosparam>

        <remap from="/camera/image_raw" to="/usb_cam/image_raw"/>
        <remap from="detected_markers/image" to="detected_markers/image"/>
        <remap from="detected_markers/pose" to="/detected_markers/output"/>
    </node>

    <node pkg="tf2_ros" type="static_transform_publisher" name="artag0_" args="0.025 0.025 -0.025 0 0 0.707 0.707 id_4 box"/>
</launch>